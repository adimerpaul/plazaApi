import{_ as U,Q as r,R as u,S as s,T as a,aB as b,V as e,aD as v,U as g,a0 as m,a1 as k,a2 as V,aC as f,W as i,X as d,aF as C,aE as D,L as w,ar as Q,a3 as P,Z as I}from"./index.e5bf0941.js";import{a as A,b as _,d as B,e as c}from"./QChip.628190ad.js";import{Q as O}from"./QBtnDropdown.fdcbe686.js";import{Q as z}from"./QMarkupTable.63640087.js";import{a as T,Q as G}from"./QForm.4feb36c2.js";const S={data(){return{search:"",loading:!1,deudores:[],dialog:!1,historyDialog:!1,deudor:{},pago:""}},mounted(){this.deudoresGet()},methods:{anularPago(o){this.$alert.confirm("\xBFEst\xE1 seguro de anular el pago?").onOk(()=>{this.loading=!0,this.$axios.post("anularPago/"+o.id).then(n=>{this.$alert.success("Pago anulado con \xE9xito");const x=this.deudor.payments.findIndex(y=>y.id===o.id);this.deudor.payments[x].status="ANULADO",this.deudoresGet()}).catch(n=>{this.$alert.error(n.response.data.message)}).finally(()=>{this.loading=!1})})},history(o){this.historyDialog=!0,this.deudor=o},agregarPago(o){this.dialog=!0,this.deudor=o,this.pago=o.debt},registrarPago(){this.loading=!0,this.$axios.post("payments",{sale_id:this.deudor.id,amount:this.pago}).then(o=>{this.$alert.success(o.data.message),this.dialog=!1,this.deudoresGet()}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},deudoresGet(){this.loading=!0,this.$axios.get("debtors",{params:{search:this.search}}).then(o=>{this.deudores=o.data}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})}}},E={class:"row"},F={class:"col-8 col-md-4"},M={class:"col-4 col-md-4"},N={class:"col-12"},L=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Operaci\xF3n"),e("th",null,"Fecha"),e("th",null,"Cliente"),e("th",null,"Total"),e("th",null,"Pago"),e("th",null,"Deuda"),e("th",null,"Usuario"),e("th",null,"Estado"),e("th",null,"Observaci\xF3n")])],-1),q={class:"text-right"},H={class:"text-right"},R={class:"text-right"},Y={class:"text-bold"},W=e("br",null,null,-1),X={class:"text-bold text-red"},Z=e("br",null,null,-1),j={class:"text-bold text-green"},J=e("br",null,null,-1),K={class:"text-bold"},$={class:"text-bold"},ee=e("br",null,null,-1),le={class:"text-bold text-red"},te=e("br",null,null,-1),ae={class:"text-bold text-green"},se=e("br",null,null,-1),oe={class:"text-bold"},ne=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Monto"),e("th",null,"Usuario"),e("th",null,"Estado")])],-1),ie={class:"text-right"};function re(o,n,x,y,t,h){return r(),u(T,{class:"bg-grey-3 q-pa-md"},{default:s(()=>[a(f,null,{default:s(()=>[a(b,{class:"q-pa-xs"},{default:s(()=>[e("div",E,[e("div",F,[a(v,{modelValue:t.search,"onUpdate:modelValue":n[0]||(n[0]=l=>t.search=l),label:"Buscar por cliente o usuario",placeholder:"Buscar",dense:"",outlined:""},null,8,["modelValue"])]),e("div",M,[a(g,{modelValue:t.search,"onUpdate:modelValue":n[1]||(n[1]=l=>t.search=l),color:"primary",label:"Buscar",onClick:h.deudoresGet,loading:t.loading,icon:"search","no-caps":""},null,8,["modelValue","onClick","loading"])]),e("div",N,[a(z,{dense:"","wrap-cells":"",separator:"cell"},{default:s(()=>[L,e("tbody",null,[(r(!0),m(V,null,k(t.deudores,l=>(r(),m("tr",{key:l.id},[e("td",null,[a(O,{label:"Opciones",color:"primary","no-caps":"",size:"10px","auto-close":""},{default:s(()=>[w((r(),u(A,{clickable:"",onClick:p=>h.agregarPago(l)},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(Q,{name:"payment",color:"green"})]),_:1}),a(_,null,{default:s(()=>[a(B,null,{default:s(()=>[d("Agregar Pago")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[P]]),w((r(),u(A,{clickable:"",onClick:p=>h.history(l)},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(Q,{name:"visibility",color:"primary"})]),_:1}),a(_,null,{default:s(()=>[a(B,null,{default:s(()=>[d("Ver Detalles")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[P]])]),_:2},1024)]),e("td",null,i(o.$filters.formatdMYHID(l.date)),1),e("td",null,i(o.$filters.capitalizeText(l.client.name+" "+l.client.lastname)),1),e("td",q,i(l.total),1),e("td",H,[l.pago>0?(r(),u(c,{key:0,color:"positive","text-color":"white",label:l.pago,dense:"",size:"10px"},null,8,["label"])):I("",!0)]),e("td",R,[l.debt>0?(r(),u(c,{key:0,color:"negative","text-color":"white",label:l.debt,dense:"",size:"10px"},null,8,["label"])):I("",!0)]),e("td",null,i(l.user.name),1),e("td",null,[l.status=="ACTIVO"?(r(),u(c,{key:0,color:"positive","text-color":"white",label:"Activo",dense:"",size:"10px"})):(r(),u(c,{key:1,color:"negative","text-color":"white",label:"Inactivo",dense:"",size:"10px"}))]),e("td",null,i(l.observacion),1)]))),128))])]),_:1})])])]),_:1})]),_:1}),a(D,{modelValue:t.dialog,"onUpdate:modelValue":n[4]||(n[4]=l=>t.dialog=l)},{default:s(()=>[a(f,{style:{width:"250px","max-width":"90vw"}},{default:s(()=>[a(b,null,{default:s(()=>[a(G,{onSubmit:h.registrarPago},{default:s(()=>[e("div",null,[e("span",Y,i(t.deudor.client.name+" "+t.deudor.client.lastname),1),W,d(" Deuda: "),e("span",X,i(t.deudor.debt),1),d(),Z,d(" Pagado: "),e("span",j,i(t.deudor.pago),1),d(),J,d(" Total: "),e("span",K,i(t.deudor.total),1)]),a(v,{modelValue:t.pago,"onUpdate:modelValue":n[2]||(n[2]=l=>t.pago=l),label:"Monto",type:"number",dense:"",outlined:"",step:"0.01",rules:[l=>l>0||"Debe ser mayor a 0",l=>l<=t.deudor.debt||"Debe ser menor o igual a la deuda"]},null,8,["modelValue","rules"]),a(C,{align:"right"},{default:s(()=>[a(g,{label:"Cancelar",color:"negative",onClick:n[3]||(n[3]=l=>t.dialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),a(g,{label:"Guardar",color:"primary",type:"submit","no-caps":"",loading:t.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(D,{modelValue:t.historyDialog,"onUpdate:modelValue":n[6]||(n[6]=l=>t.historyDialog=l)},{default:s(()=>[a(f,{style:{width:"500px","max-width":"90vw"}},{default:s(()=>[a(b,null,{default:s(()=>[e("div",null,[e("span",$,i(t.deudor.client.name+" "+t.deudor.client.lastname),1),ee,d(" Deuda: "),e("span",le,i(t.deudor.debt),1),d(),te,d(" Pagado: "),e("span",ae,i(t.deudor.pago),1),d(),se,d(" Total: "),e("span",oe,i(t.deudor.total),1)]),a(z,{dense:"","wrap-cells":"",separator:"cell"},{default:s(()=>[ne,e("tbody",null,[(r(!0),m(V,null,k(t.deudor.payments,l=>{var p;return r(),m("tr",{key:l.id},[e("td",null,[a(g,{label:"Anular",color:"negative",dense:"",icon:"delete","no-caps":"",size:"10px",onClick:de=>h.anularPago(l)},null,8,["onClick"])]),e("td",null,i(o.$filters.formatdMYHID(l.date)),1),e("td",ie,i(l.amount),1),e("td",null,i((p=l.user)==null?void 0:p.name),1),e("td",null,[l.status=="PAGADO"?(r(),u(c,{key:0,color:"positive","text-color":"white",label:"Pagado",dense:"",size:"10px"})):(r(),u(c,{key:1,color:"negative","text-color":"white",label:"Anulado",dense:"",size:"10px"}))])])}),128))])]),_:1}),a(C,{align:"right"},{default:s(()=>[a(g,{label:"Cerrar",color:"negative",onClick:n[5]||(n[5]=l=>t.historyDialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var me=U(S,[["render",re]]);export{me as default};
