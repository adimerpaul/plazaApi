import{_ as q,Q as r,R as v,S as a,T as l,aB as p,V as e,aD as f,a0 as u,a1 as V,a2 as C,aC as _,ar as w,U as m,$ as I,W as d,X as g,Z as A,aF as P,aE as U,L as k,bb as Q}from"./index.e5bf0941.js";import{a as x,Q as b}from"./QSpace.7be629cb.js";import{Q as D}from"./QImg.f4396dbb.js";import{Q as S}from"./QMarkupTable.63640087.js";import{a as T,Q as F}from"./QForm.4feb36c2.js";import{I as N}from"./Imprimir.2f8e4ae4.js";import"./QChip.628190ad.js";import"./format.2cae61da.js";const B={name:"ProductsIndex",data(){return{products:[],productsAll:[],clients:[],clientsAll:[],client:"",product:{},categories:[],category:"",search:"",saleDialog:!1,loading:!1,tipo:"",tipos:["CREDITO","CONTADO"],monto:"",observacion:"",pago:""}},mounted(){this.productsGet(),this.clientGet(),this.categoriesGet()},methods:{saleInsert(){this.loading=!0,this.$axios.post("sales",{client_id:this.client.id,tipo:this.tipo,monto:this.monto,products:this.$store.orders,observacion:this.observacion,pago:this.pago}).then(s=>{this.$alert.success("Venta realizada con \xE9xito"),this.saleDialog=!1,this.cartClear(),this.productsGet(),N.nota(s.data)}).catch(s=>{this.$alert.error("Error al realizar la venta")}).finally(()=>{this.loading=!1})},clientGet(){this.$axios.get("clientsCliente").then(s=>{this.clients=s.data,this.clientsAll=s.data})},pay(){if(this.$store.orders.length===0)return this.$alert.error("No hay productos en el carrito"),!1;if(this.$store.orders.some(s=>s.stock<s.quantity))return this.$alert.error("No hay stock suficiente "+this.$store.orders.find(s=>s.stock<s.quantity).name),!1;this.saleDialog=!0,this.client="",this.tipo="",this.monto="",this.observacion="",this.pago=""},deleteProduct(s){const o=this.$store.orders.findIndex(c=>c.id===s.id);this.$store.orders.splice(o,1)},sumNum(s,o){return(parseFloat(s)*parseInt(o)).toFixed(2)},orderAdd(s){const o=this.$store.orders.find(c=>c.id===s.id);o?o.quantity++:this.$store.orders.push({...s,quantity:1})},cartClear(){this.$store.orders=[]},productsGet(){this.$axios.get("products").then(s=>{this.products=s.data,this.productsAll=s.data})},categoriesGet(){this.categories=[{id:"",name:"Todas"}],this.$axios.get("categories").then(s=>{this.categories=this.categories.concat(s.data)})},filterProductsSearch(){this.search===""?this.products=this.productsAll:this.products=this.productsAll.filter(s=>s.name.toLowerCase().includes(this.search.toLowerCase()))},filterProducts(){console.log(this.category),this.category.id===""?this.products=this.productsAll:this.products=this.productsAll.filter(s=>s.category_id===this.category.id)},fnFilter(s,o,c){if(s===""){o(()=>{this.clients=this.clientsAll});return}o(()=>{const y=s.toLowerCase();this.clients=this.clientsAll.filter(i=>i.name.toLowerCase().indexOf(y)>-1)})}},computed:{total(){return this.$store.orders.reduce((s,o)=>s+parseFloat(o.price)*parseInt(o.quantity),0).toFixed(2)}}},E={class:"row"},G={class:"col-12 col-md-8"},L={class:"row"},O={class:"col-12 col-md-4"},z={class:"col-12 col-md-3 text-right"},R=e("div",{class:"col-12 col-md-5 text-right"},null,-1),M={class:"col-12"},W={class:"row"},X={class:"absolute-bottom text-subtitle2 text-center text-bold",style:{padding:"0px",background:"linear-gradient(rgba(0,0,0,0.05), rgba(0,0,0,0.7))",color:"white","line-height":"1"}},Z={class:"row items-center"},j={class:"text-bold text-center q-pl-xs"},H={class:"text-bold text-center q-pr-xs"},J={class:"col-12 col-md-4"},K={class:"row"},Y=e("div",{class:"text-subtitle2 text-primary text-bold q-pl-xs"}," Carrito de Compras ",-1),$=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Producto"),e("th",{class:"text-right"},"Precio"),e("th",{class:"text-right"},"Cantidad"),e("th",{class:"text-right",width:"80px"},"Total")])],-1),ee={key:0},te={style:{"max-width":"170px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},se={class:"text-right"},oe=["onUpdate:modelValue"],le={class:"text-right"},ie=["onUpdate:modelValue"],ae={class:"text-right"},ne={key:1},re=e("tr",null,[e("td",{colspan:"4",class:"text-center"}," No hay productos en el carrito ")],-1),de=[re],ce=e("td",{colspan:"3",class:"text-right text-bold"}," Total ",-1),ue={class:"text-right text-subtitle2 text-red text-bold"},he={colspan:"4"},pe=e("div",{class:"text-h6 text-primary text-center text-bold"}," Pago ",-1),me={class:"row"},_e={class:"col-12 col-md-4"},ge={class:"col-6 col-md-2 text-bold text-red text-h6 text-center"},xe={style:{"line-height":"1"}},fe=e("span",{class:"text-grey"},"Total",-1),be=e("br",null,null,-1),ye={class:"col-6 col-md-4"},ve={class:"col-12 col-md-2"},Ve={class:"col-12 col-md-6"},Ce={class:"col-12 col-md-4"},we=e("div",{id:"myElement",class:"hidden"},null,-1);function ke(s,o,c,y,i,n){return r(),v(T,{class:"bg-grey-3 q-pa-xs"},{default:a(()=>[l(_,null,{default:a(()=>[l(p,{class:"q-pa-xs"},{default:a(()=>[e("div",E,[e("div",G,[e("div",L,[e("div",O,[l(f,{modelValue:i.search,"onUpdate:modelValue":[o[0]||(o[0]=t=>i.search=t),n.filterProductsSearch],label:"Buscar",outlined:"",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),e("div",z,[l(x,{modelValue:i.category,"onUpdate:modelValue":[o[1]||(o[1]=t=>i.category=t),n.filterProducts],options:i.categories,label:"Categor\xEDa",outlined:"",dense:"","option-value":"id","option-label":"name"},null,8,["modelValue","options","onUpdate:modelValue"])]),R,e("div",M,[e("div",W,[(r(!0),u(C,null,V(i.products,t=>(r(),u("div",{class:"col-6 col-md-2",key:t.id},[l(_,{class:"q-ma-xs cursor-pointer",flat:"",bordered:"",onClick:h=>n.orderAdd(t)},{default:a(()=>[l(D,{src:`${s.$url}../images/${t.image}`,"spinner-color":"white","spinner-size":"40",style:{height:"100px"}},{default:a(()=>[e("div",X,[g(d(t.name)+" ",1),e("div",Z,[e("div",j,d(t.stock),1),l(b),e("div",H,d(t.price)+" $ ",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),128))])])])]),e("div",J,[l(_,null,{default:a(()=>[l(p,{class:"q-pb-none row items-center"},{default:a(()=>[e("div",K,[l(w,{name:"o_shopping_cart"}),Y]),l(b),l(m,{flat:"",dense:"",icon:"o_delete",onClick:n.cartClear,size:"10px",label:"Vaciar","no-caps":"",color:"red"},null,8,["onClick"])]),_:1}),l(I),l(p,{class:"q-pa-none"},{default:a(()=>[l(S,{dense:"","wrap-cells":""},{default:a(()=>[$,s.$store.orders.length>0?(r(),u("tbody",ee,[(r(!0),u(C,null,V(s.$store.orders,t=>(r(),u("tr",{key:t.id},[e("td",null,[e("div",te,[l(w,{name:"o_delete",class:"cursor-pointer",color:"red",onClick:h=>n.deleteProduct(t)},null,8,["onClick"]),g(" "+d(t.name),1)])]),e("td",se,[k(e("input",{"onUpdate:modelValue":h=>t.price=h,type:"number",min:"1",style:{width:"50px"},step:"0.01"},null,8,oe),[[Q,t.price]])]),e("td",le,[k(e("input",{"onUpdate:modelValue":h=>t.quantity=h,type:"number",min:"1",style:{width:"50px"}},null,8,ie),[[Q,t.quantity]])]),e("td",ae,d(n.sumNum(t.price,t.quantity))+" $ ",1)]))),128))])):(r(),u("tbody",ne,de)),e("tfoot",null,[e("tr",null,[ce,e("td",ue,d(n.total)+" $ ",1)]),e("tr",null,[e("td",he,[l(m,{dense:"",color:"primary",label:"Pagar","no-caps":"",icon:"o_payment",push:"",class:"full-width text-bold",onClick:n.pay},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1}),l(U,{modelValue:i.saleDialog,"onUpdate:modelValue":o[9]||(o[9]=t=>i.saleDialog=t),persistent:""},{default:a(()=>[l(_,{style:{width:"700px","max-width":"90vw"}},{default:a(()=>[l(p,{class:"q-pb-none row items-center"},{default:a(()=>[pe,l(b),l(m,{flat:"",dense:"",icon:"cancel",onClick:o[2]||(o[2]=t=>i.saleDialog=!1)})]),_:1}),l(p,null,{default:a(()=>[l(F,{onSubmit:n.saleInsert},{default:a(()=>[e("div",me,[e("div",_e,[l(x,{modelValue:i.client,"onUpdate:modelValue":o[3]||(o[3]=t=>i.client=t),options:i.clients,label:"Cliente",outlined:"",dense:"",onFilter:n.fnFilter,"use-input":"","option-value":"id","option-label":"name",rules:[t=>!!t||"Seleccione un cliente"]},null,8,["modelValue","options","onFilter","rules"])]),e("div",ge,[e("div",xe,[fe,g(),be,g(" "+d(n.total)+"$ ",1)])]),e("div",ye,[l(x,{modelValue:i.tipo,"onUpdate:modelValue":o[4]||(o[4]=t=>i.tipo=t),options:i.tipos,label:"Tipo",outlined:"",dense:"",rules:[t=>!!t||"Seleccione un tipo"]},null,8,["modelValue","options","rules"])]),e("div",ve,[i.tipo==="CREDITO"?(r(),v(f,{key:0,modelValue:i.monto,"onUpdate:modelValue":o[5]||(o[5]=t=>i.monto=t),label:"Adelanto",outlined:"",dense:"",type:"number",rules:[t=>!!t||"Ingrese un monto",t=>t>=0||"Ingrese un monto v\xE1lido",t=>t<=n.total||"El monto no puede ser mayor al total"]},null,8,["modelValue","rules"])):A("",!0)]),e("div",Ve,[l(f,{modelValue:i.observacion,"onUpdate:modelValue":o[6]||(o[6]=t=>i.observacion=t),label:"Observaci\xF3n",outlined:"",dense:"",type:"textarea",rows:"2"},null,8,["modelValue"])]),e("div",Ce,[l(x,{modelValue:i.pago,"onUpdate:modelValue":o[7]||(o[7]=t=>i.pago=t),options:s.$metodos,label:"Pago",outlined:"",dense:"",rules:[t=>!!t||"Seleccione un pago"]},null,8,["modelValue","options","rules"])])]),l(P,{align:"right"},{default:a(()=>[l(m,{label:"Cancelar",color:"red","no-caps":"",class:"text-bold",push:"",icon:"cancel",onClick:o[8]||(o[8]=t=>i.saleDialog=!1),loading:i.loading},null,8,["loading"]),l(m,{label:"Pagar",color:"primary","no-caps":"",class:"text-bold",push:"",icon:"o_payment",type:"submit",loading:i.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),we]),_:1})}var Te=q(B,[["render",ke]]);export{Te as default};
